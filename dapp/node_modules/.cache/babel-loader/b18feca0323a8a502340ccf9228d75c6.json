{"ast":null,"code":"function callbackify(fn) {\n  var fnLength = fn.length;\n  return function () {\n    var args = [].slice.call(arguments);\n    var ctx = this;\n\n    if (args.length === fnLength + 1 && typeof args[fnLength] === 'function') {\n      // callback mode\n      var cb = args.pop();\n      fn.apply(this, args).then(function (val) {\n        cb.call(ctx, null, val);\n      }, function (err) {\n        cb.call(ctx, err);\n      });\n      return;\n    } // promise mode\n\n\n    return fn.apply(ctx, arguments);\n  };\n}\n\nfunction callbackifyVariadic(fn) {\n  return function () {\n    var args = [].slice.call(arguments);\n    var ctx = this;\n\n    if (args.length >= 1 && typeof args[args.length - 1] === 'function') {\n      // callback mode\n      var cb = args.pop();\n      fn.apply(this, args).then(function (val) {\n        cb.call(ctx, null, val);\n      }, function (err) {\n        cb.call(ctx, err);\n      });\n      return;\n    } // promise mode\n\n\n    return fn.apply(ctx, arguments);\n  };\n}\n\nmodule.exports = callbackify;\nmodule.exports.variadic = callbackifyVariadic;","map":null,"metadata":{},"sourceType":"script"}